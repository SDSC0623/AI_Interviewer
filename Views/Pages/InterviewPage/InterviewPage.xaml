<Page x:Class="AI_Interviewer.Views.Pages.InterviewPage.InterviewPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      xmlns:interviewPage="clr-namespace:AI_Interviewer.ViewModels.InterviewPage"
      xmlns:converters="clr-namespace:AI_Interviewer.Converters"
      xmlns:extensions="clr-namespace:AI_Interviewer.Extensions"
      xmlns:models="clr-namespace:AI_Interviewer.Models"
      xmlns:controls="clr-namespace:AI_Interviewer.Controls"
      MaxHeight="2200"
      mc:Ignorable="d"
      d:DesignHeight="1800"
      d:DesignWidth="1000"
      ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
      ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
      d:DataContext="{d:DesignInstance Type=interviewPage:InterviewPageViewModel}"
      Title="InterviewPage">
    <Page.Resources>
        <converters:EnumDescriptionConverter x:Key="EnumDescriptionConverter" />
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:BoolInverseConverter x:Key="BoolInverseConverter" />
        <extensions:EnumBindingSource x:Key="DifficultyLevelEnumBinding" EnumType="{x:Type models:DifficultyLevel}" />
        <extensions:EnumBindingSource x:Key="FollowUpDepthLevelEnumBinding"
                                      EnumType="{x:Type models:FollowUpDepthLevel}" />
    </Page.Resources>
    <Grid Margin="42, 16">
        <!-- 面试选项调节分页 -->
        <Grid
            Visibility="{Binding Interviewing, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=True}">
            <ui:DynamicScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,0,0,20">
                <StackPanel>
                    <!-- 页面标题 -->
                    <Grid Margin="0,0,0,30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- 页面标题图标 -->
                        <ui:SymbolIcon Grid.Column="0" Symbol="Settings24"
                                       Filled="True"
                                       FontSize="24"
                                       Margin="0,0,12,0"
                                       Foreground="#9C27B0" />
                        <!-- 页面标题文本 -->
                        <ui:TextBlock Grid.Column="1" Text="面试设置"
                                      FontTypography="Title"
                                      FontSize="24" />
                    </Grid>

                    <!-- 麦克风和摄像头测试卡片 -->
                    <ui:Border CornerRadius="12"
                               Background="{DynamicResource ControlFillColorDefaultBrush}"
                               BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                               BorderThickness="1"
                               Margin="0,0,0,20"
                               Padding="25">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <!-- 卡片标题 -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <ui:SymbolIcon Symbol="Camera24"
                                               FontSize="20"
                                               Foreground="#2196F3"
                                               Margin="0,0,10,0" />
                                <ui:TextBlock Text="麦克风和摄像头测试"
                                              FontTypography="Subtitle"
                                              FontSize="18" />
                            </StackPanel>

                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="30" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <!-- 摄像头测试区域 -->
                                <StackPanel Grid.Column="0" Margin="0,0,0,20">
                                    <ui:TextBlock Text="摄像头测试"
                                                  FontTypography="BodyStrong"
                                                  FontSize="14"
                                                  Margin="0,0,0,8" />

                                    <!-- 摄像头预览区域 -->
                                    <ui:Border CornerRadius="8"
                                               BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                               BorderThickness="1"
                                               Background="{DynamicResource LayerOnAcrylicFillColorDefaultBrush}"
                                               Height="300" MaxWidth="533"
                                               Margin="0,0,0,12">
                                        <Grid>
                                            <!-- 摄像头视频预览 -->
                                            <ui:Border CornerRadius="6"
                                                       Background="{DynamicResource ControlFillColorSecondaryBrush}">
                                                <!-- 摄像头视频控件可以放在这里 -->
                                                <Image Source="{Binding CameraPicture}"
                                                       Stretch="Uniform" Height="300"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center" />
                                            </ui:Border>

                                            <!-- 无摄像头提示 -->
                                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                                        Margin="40"
                                                        Visibility="{Binding IsCameraActive, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=True}">
                                                <ui:SymbolIcon Symbol="VideoOff24" FontSize="48" Margin="0,0,0,12" />
                                                <ui:TextBlock Text="摄像头未连接" FontSize="16" />
                                            </StackPanel>
                                        </Grid>
                                    </ui:Border>

                                    <!-- 摄像头测试按钮 -->
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="10" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="10" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="10" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="10" />
                                        </Grid.ColumnDefinitions>
                                        <controls:TwoStateButton Grid.Row="0" Grid.Column="0"
                                                                 Padding="12,8" Appearance="Primary"
                                                                 IsChecked="{Binding IsTestingCamera}"
                                                                 EnableContent="开始测试"
                                                                 EnableIcon="{ui:SymbolIcon Video24}"
                                                                 EnableCommand="{Binding StartCameraTestCommand}"
                                                                 DisableContent="停止测试"
                                                                 DisableIcon="{ui:SymbolIcon Stop24}"
                                                                 DisableCommand="{Binding StopCameraTestCommand}" />
                                        <ComboBox Grid.Row="0" Grid.Column="2"
                                                  ItemsSource="{Binding CameraDevices}"
                                                  SelectedItem="{Binding SelectedCamera}"
                                                  DisplayMemberPath="Name" />
                                        <ui:Button Grid.Row="0" Grid.Column="4"
                                                   Command="{Binding RefreshCameraDevicesCommand}"
                                                   Icon="{ui:SymbolIcon ArrowSync24, FontSize=22, Filled=True}" />
                                        <CheckBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="6"
                                                  Content="屏幕翻转" IsChecked="{Binding NeedMirrorHorizontal}" />
                                    </Grid>
                                </StackPanel>

                                <!-- 麦克风测试区域 -->
                                <StackPanel Grid.Column="2">
                                    <ui:TextBlock Text="麦克风测试"
                                                  FontTypography="BodyStrong"
                                                  FontSize="14"
                                                  Margin="0,0,0,8" />

                                    <!-- 麦克风音量指示器 -->
                                    <ui:Border CornerRadius="8"
                                               BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                               BorderThickness="1"
                                               Background="{DynamicResource LayerOnAcrylicFillColorDefaultBrush}"
                                               Height="60" Padding="10"
                                               Margin="0,0,0,12">
                                        <Grid>
                                            <ProgressBar
                                                Height="16" Minimum="0" Maximum="1"
                                                Value="{Binding MicrophoneVolume}"
                                                Margin="0,0,0,8" />
                                        </Grid>
                                    </ui:Border>

                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ComboBox Grid.Column="0"
                                                  ItemsSource="{Binding MicrophoneDevices}"
                                                  SelectedItem="{Binding SelectedMicrophone}"
                                                  DisplayMemberPath="Name"
                                                  Margin="0,0,12,0" />
                                        <ui:Button Grid.Column="1"
                                                   Icon="{ui:SymbolIcon ArrowSync24, FontSize=22, Filled=True}"
                                                   Command="{Binding RefreshMicrophoneDevicesCommand}" />
                                    </Grid>

                                    <!-- 麦克风测试按钮 -->
                                    <StackPanel Orientation="Horizontal">
                                        <controls:TwoStateButton
                                            Padding="12,8" Appearance="Primary"
                                            FontSize="13" Margin="0,0,12,0"
                                            IsChecked="{Binding IsTestingMicrophone}"
                                            EnableContent="开始麦克风测试"
                                            EnableIcon="{ui:SymbolIcon Mic16}"
                                            EnableCommand="{Binding StartTestMicrophoneCommand}"
                                            DisableContent="停止测试"
                                            DisableIcon="{ui:SymbolIcon Stop16}"
                                            DisableCommand="{Binding StopTestMicrophoneCommand}" />
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </ui:Border>

                    <!-- 面试难度设置卡片 -->
                    <ui:Border CornerRadius="12"
                               Background="{DynamicResource ControlFillColorDefaultBrush}"
                               BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                               BorderThickness="1"
                               Margin="0,0,0,20"
                               Padding="25">
                        <StackPanel>
                            <!-- 卡片标题 -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <ui:SymbolIcon Symbol="Flag24"
                                               FontSize="20"
                                               Foreground="#4CAF50"
                                               Margin="0,0,10,0" />
                                <ui:TextBlock Text="面试难度设置"
                                              FontTypography="Subtitle"
                                              FontSize="18" />
                            </StackPanel>

                            <!-- 难度选择下拉框 -->
                            <Grid Margin="0,0,0, 20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock Grid.Column="0" Text="选择面试难度："
                                              FontTypography="BodyStrong"
                                              FontSize="14" VerticalAlignment="Center"
                                              Margin="0,0,8,0" />
                                <ComboBox Grid.Column="1"
                                          SelectedValue="{Binding SelectedDifficulty, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          ItemsSource="{Binding Source={StaticResource DifficultyLevelEnumBinding}}"
                                          FontSize="14" Padding="12,8"
                                          Background="{DynamicResource ControlFillColorDefaultBrush}"
                                          BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <ui:TextBlock
                                                Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"
                                                TextAlignment="Left" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </Grid>

                            <!-- 难度说明 -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="40" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <ui:TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Text="难度说明："
                                              FontTypography="BodyStrong"
                                              FontSize="14"
                                              FontWeight="SemiBold"
                                              Margin="0,0,0,8" />

                                <!-- 初级 -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,10">
                                    <ui:SymbolIcon Symbol="CircleSmall24"
                                                   FontSize="12" Filled="True"
                                                   Margin="0,0,8,0"
                                                   Foreground="#4CAF50" />
                                    <StackPanel>
                                        <ui:TextBlock Text="初级"
                                                      FontTypography="Body"
                                                      FontSize="14" />
                                        <ui:TextBlock Text="基础问题，适合应届生或初入职场"
                                                      FontTypography="Caption"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                      Margin="4,2,0,0" />
                                    </StackPanel>
                                </StackPanel>

                                <!-- 中级 -->
                                <StackPanel Grid.Row="1" Grid.Column="2" Orientation="Horizontal" Margin="0,0,0,10">
                                    <ui:SymbolIcon Symbol="CircleSmall24"
                                                   FontSize="12" Filled="True"
                                                   Margin="0,0,8,0"
                                                   Foreground="#2196F3" />
                                    <StackPanel>
                                        <ui:TextBlock Text="中级"
                                                      FontTypography="Body"
                                                      FontSize="14" />
                                        <ui:TextBlock Text="需要一定经验，适合有1-3年工作经验"
                                                      FontTypography="Caption"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                      Margin="4,2,0,0" />
                                    </StackPanel>
                                </StackPanel>

                                <!-- 高级 -->
                                <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Margin="0,0,0,10">
                                    <ui:SymbolIcon Symbol="CircleSmall24"
                                                   FontSize="12" Filled="True"
                                                   Margin="0,0,8,0"
                                                   Foreground="#FF9800" />
                                    <StackPanel>
                                        <ui:TextBlock Text="高级"
                                                      FontTypography="Body"
                                                      FontSize="14" />
                                        <ui:TextBlock Text="深度问题，适合资深从业者"
                                                      FontTypography="Caption"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                      Margin="4,2,0,0" />
                                    </StackPanel>
                                </StackPanel>

                                <!-- 专家 -->
                                <StackPanel Grid.Row="2" Grid.Column="2" Orientation="Horizontal">
                                    <ui:SymbolIcon Symbol="CircleSmall24"
                                                   FontSize="12" Filled="True"
                                                   Margin="0,0,8,0"
                                                   Foreground="#9C27B0" />
                                    <StackPanel>
                                        <ui:TextBlock Text="专家"
                                                      FontTypography="Body"
                                                      FontSize="14" />
                                        <ui:TextBlock Text="包含各种难度的题目"
                                                      FontTypography="Caption"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                      Margin="4,2,0,0" />
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ui:Border>

                    <!-- 自定义面试题卡片 -->
                    <ui:Border CornerRadius="12"
                               Background="{DynamicResource ControlFillColorDefaultBrush}"
                               BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                               BorderThickness="1"
                               Margin="0,0,0,20"
                               Padding="25">
                        <StackPanel>
                            <!-- 卡片标题 -->
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <ui:SymbolIcon Symbol="DocumentAdd24"
                                                   FontSize="20"
                                                   Foreground="#FF9800"
                                                   Margin="0,0,10,0" />
                                    <ui:TextBlock Text="自定义面试题"
                                                  FontTypography="Subtitle"
                                                  FontSize="18" />
                                </StackPanel>
                            </Grid>

                            <!-- 添加自定义题目按钮 -->
                            <ui:Button
                                Content="添加自定义面试题"
                                Padding="16,10"
                                HorizontalAlignment="Left"
                                Appearance="Success" Icon="{ui:SymbolIcon Add16}"
                                Command="{Binding AddCustomQuestionCommand}"
                                FontSize="14" />

                            <!-- 自定义题目列表 -->
                            <ui:Border
                                CornerRadius="8"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                Background="{DynamicResource LayerOnAcrylicFillColorDefaultBrush}"
                                Margin="0,20,0,0"
                                MaxHeight="470"
                                Visibility="{Binding HasCustomQuestions, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <ui:DynamicScrollViewer>
                                    <ItemsControl ItemsSource="{Binding CustomQuestions}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <ui:Border CornerRadius="6" Padding="16,12" Margin="0, 5">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="10" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>

                                                        <!-- 题目内容 -->
                                                        <Grid Grid.Column="0">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="20" />
                                                                <ColumnDefinition Width="*" />
                                                            </Grid.ColumnDefinitions>
                                                            <ui:TextBox Grid.Column="0" FontSize="14"
                                                                        PlaceholderText="请输入题目"
                                                                        TextWrapping="Wrap"
                                                                        Text="{Binding QuestionText, UpdateSourceTrigger=PropertyChanged}" />
                                                            <ComboBox Grid.Column="2"
                                                                      SelectedValue="{Binding Difficulty, UpdateSourceTrigger=PropertyChanged}"
                                                                      ItemsSource="{Binding Source={StaticResource DifficultyLevelEnumBinding}}"
                                                                      FontSize="14" Padding="12,8"
                                                                      Background="{DynamicResource ControlFillColorDefaultBrush}"
                                                                      BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}">
                                                                <ComboBox.ItemTemplate>
                                                                    <DataTemplate>
                                                                        <ui:TextBlock
                                                                            Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"
                                                                            TextAlignment="Left" />
                                                                    </DataTemplate>
                                                                </ComboBox.ItemTemplate>
                                                            </ComboBox>
                                                        </Grid>
                                                        <!-- 删除按钮 -->
                                                        <ui:Button Grid.Column="2"
                                                                   VerticalAlignment="Center"
                                                                   Padding="8"
                                                                   Icon="{ui:SymbolIcon Delete16, Filled=True}"
                                                                   Appearance="Danger"
                                                                   Command="{Binding DataContext.RemoveCustomQuestionCommand, RelativeSource={RelativeSource FindAncestor, AncestorType=Page}}"
                                                                   CommandParameter="{Binding}" />
                                                    </Grid>
                                                </ui:Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ui:DynamicScrollViewer>
                            </ui:Border>

                            <!-- 无自定义题目提示 -->
                            <ui:Border
                                CornerRadius="8"
                                Background="{DynamicResource LayerOnAcrylicFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                Margin="0,20,0,0"
                                Padding="20"
                                Visibility="{Binding HasCustomQuestions, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=True}">
                                <StackPanel HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Margin="0,20">
                                    <ui:SymbolIcon Symbol="DocumentSearch24"
                                                   FontSize="48"
                                                   Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                                   Margin="0,0,0,12" />
                                    <ui:TextBlock Text="暂无自定义面试题"
                                                  FontSize="16"
                                                  Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                  Margin="0,0,0,8" />
                                    <ui:TextBlock Text="点击上方按钮添加自定义面试题"
                                                  FontTypography="Caption"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                                  TextAlignment="Center" />
                                </StackPanel>
                            </ui:Border>
                        </StackPanel>
                    </ui:Border>

                    <!-- 面试题数设置卡片 -->
                    <ui:Border CornerRadius="12"
                               Background="{DynamicResource ControlFillColorDefaultBrush}"
                               BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                               BorderThickness="1"
                               Margin="0,0,0,20"
                               Padding="25">
                        <StackPanel>
                            <!-- 卡片标题 -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <ui:SymbolIcon Symbol="NumberCircle124"
                                               FontSize="20"
                                               Foreground="#9C27B0"
                                               Margin="0,0,10,0" />
                                <ui:TextBlock Text="面试题数设置"
                                              FontTypography="Subtitle"
                                              FontSize="18" />
                            </StackPanel>

                            <!-- 题目总数设置 -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <ui:TextBlock Grid.Row="0" Grid.Column="0" Text="面试题总数："
                                              FontTypography="BodyStrong"
                                              FontSize="14" VerticalAlignment="Center" />

                                <ui:NumberBox Grid.Row="0" Grid.Column="1"
                                              Value="{Binding InterviewQuestionCount, UpdateSourceTrigger=PropertyChanged}"
                                              Minimum="{Binding MinQuestionCount}" Maximum="50"
                                              ClearButtonEnabled="False"
                                              Width="180"
                                              HorizontalAlignment="Left"
                                              FontSize="14"
                                              Padding="12,8" />

                                <!-- 题目数量提示 -->
                                <ui:Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                           Margin="0,12,0,0"
                                           Padding="12,8"
                                           Visibility="{Binding NeedQuestionCountWarning, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <StackPanel Orientation="Horizontal">
                                        <ui:SymbolIcon Symbol="Warning16"
                                                       FontSize="16"
                                                       Foreground="#F44336"
                                                       Margin="0,0,8,0" />
                                        <ui:TextBlock Text="必须大于等于自定义题目数量"
                                                      FontTypography="Caption"
                                                      FontSize="12"
                                                      Foreground="#F44336" />
                                    </StackPanel>
                                </ui:Border>
                            </Grid>
                        </StackPanel>
                    </ui:Border>

                    <!-- 底部按钮栏 -->
                    <Grid Margin="0,20,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- 左侧留空 -->
                        <StackPanel Grid.Column="0" />

                        <!-- 下一步按钮 -->
                        <ui:Button Grid.Column="1"
                                   Content="下一步"
                                   Padding="16,10"
                                   Appearance="Primary"
                                   Command="{Binding StartInterviewCommand}"
                                   FontSize="14" Icon="{ui:SymbolIcon ArrowRight24}" />
                    </Grid>
                </StackPanel>
            </ui:DynamicScrollViewer>
        </Grid>


        <!-- 面试分页 -->
        <Grid Visibility="{Binding Interviewing, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <!-- 顶部标题 -->
                    <RowDefinition Height="Auto" />
                    <!-- 主内容区域 -->
                    <RowDefinition Height="*" />
                    <!-- 底部按钮 -->
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- 顶部标题 -->
                <ui:Border Grid.Row="0"
                           CornerRadius="0,0,12,12"
                           Background="#2196F3"
                           Margin="0,0,0,20"
                           Padding="20,15">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <ui:SymbolIcon Symbol="VideoChat24"
                                       Filled="True"
                                       FontSize="24"
                                       Foreground="White"
                                       Margin="0,0,12,0" />
                        <ui:TextBlock Text="模拟面试进行中"
                                      FontTypography="Title"
                                      FontSize="24"
                                      FontWeight="Bold"
                                      Foreground="White" />
                    </StackPanel>
                </ui:Border>

                <!-- 主内容区域 -->
                <Grid Grid.Row="1" Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <!-- 左侧：面试题目和回答区域 -->
                        <ColumnDefinition Width="*" />
                        <!-- 中间间距 -->
                        <ColumnDefinition Width="20" />
                        <!-- 右侧：视频和语音区域 -->
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- 左侧区域 -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <!-- 面试题目 -->
                            <RowDefinition Height="*" />
                            <!-- 中间间距 -->
                            <RowDefinition Height="20" />
                            <!-- 追问和回答 -->
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>


                        <!-- 面试题目卡片 -->
                        <ui:Border Grid.Row="0"
                                   CornerRadius="12"
                                   Background="{DynamicResource ControlFillColorDefaultBrush}"
                                   BorderBrush="#4CAF50"
                                   BorderThickness="2"
                                   Padding="25">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- 题目标题 -->
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                    <ui:SymbolIcon Symbol="DocumentBulletList24"
                                                   FontSize="20"
                                                   Foreground="#4CAF50"
                                                   Margin="0,0,10,0" />
                                    <ui:TextBlock Text="面试题目"
                                                  FontTypography="Subtitle"
                                                  FontSize="18"
                                                  FontWeight="SemiBold" />
                                </StackPanel>

                                <!-- 生成题目提示 -->
                                <controls:LoadingBox Grid.Row="1" LoadingMessage="正在生成面试题，这可能需要一段时间，请耐心等待。"
                                                     IsActive="{Binding HasGeneratedQuestion, Converter={StaticResource BoolInverseConverter}}" />

                                <Grid Grid.Row="1"
                                      Visibility="{Binding HasGeneratedQuestion, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <!-- 题目标号 -->
                                    <Grid Grid.Row="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="20" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <ui:TextBlock Grid.Column="0" Text="{Binding CurrentQuestionIndexText}"
                                                      FontTypography="BodyStrong" FontSize="16" TextWrapping="Wrap" />

                                        <Grid Grid.Column="2">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <!-- 情绪标签 -->
                                            <ui:TextBlock Grid.Column="0"
                                                          Text="难度："
                                                          FontTypography="BodyStrong"
                                                          FontSize="14" />

                                            <!-- 情绪值显示 -->
                                            <ui:TextBlock Grid.Column="1"
                                                          Text="{Binding CurrentQuestion.Difficulty, Converter={StaticResource EnumDescriptionConverter}}"
                                                          FontTypography="Body"
                                                          FontSize="14" />
                                        </Grid>
                                    </Grid>
                                    <!-- 题目内容 -->
                                    <ui:TextBlock Grid.Row="1" Text="{Binding CurrentQuestion.QuestionText}"
                                                  FontTypography="Body" FontSize="16"
                                                  TextWrapping="Wrap" Margin="0,20" />
                                </Grid>
                            </Grid>
                        </ui:Border>

                        <!-- 追问和回答区域 -->
                        <Grid Grid.Row="2">
                            <Grid.RowDefinitions>
                                <!-- 追问设置 -->
                                <RowDefinition Height="Auto" />
                                <!-- 回答区域 -->
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- 追问设置卡片 -->
                            <ui:Border Grid.Row="0"
                                       CornerRadius="12"
                                       Background="{DynamicResource ControlFillColorDefaultBrush}"
                                       BorderBrush="#9C27B0"
                                       BorderThickness="2"
                                       Padding="25"
                                       Margin="0,0,0,20">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <!-- 追问设置标题 -->
                                    <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3"
                                                Orientation="Horizontal" Margin="0,0,0,10">
                                        <ui:SymbolIcon Symbol="Search24"
                                                       FontSize="20"
                                                       Foreground="#9C27B0"
                                                       Margin="0,0,10,0" />
                                        <ui:TextBlock Text="追问设置"
                                                      FontTypography="Subtitle"
                                                      FontSize="18"
                                                      FontWeight="SemiBold" />
                                    </StackPanel>

                                    <!-- 追问深度设置 -->
                                    <ui:TextBlock Grid.Row="1" Grid.Column="0" Text="追问深度：" Margin="0,10"
                                                  FontTypography="BodyStrong" FontSize="14" VerticalAlignment="Center" />

                                    <ComboBox Grid.Row="1" Grid.Column="1"
                                              SelectedValue="{Binding FollowUpDepth, UpdateSourceTrigger=PropertyChanged}"
                                              ItemsSource="{Binding Source={StaticResource FollowUpDepthLevelEnumBinding}}"
                                              FontSize="14">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <ui:TextBlock
                                                    Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"
                                                    TextAlignment="Left" />
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>

                                    <!-- 生成追问按钮 -->
                                    <ui:Button Grid.Row="1" Grid.Column="2"
                                               Content="生成追问" Icon="{ui:SymbolIcon Sparkle24}"
                                               Padding="8,6" Margin="10,0,0,0"
                                               HorizontalAlignment="Left"
                                               Appearance="Primary" FontSize="14"
                                               Command="{Binding GenerateFollowUpCommand}" />
                                </Grid>
                            </ui:Border>

                            <!-- 回答显示卡片 -->
                            <ui:Border Grid.Row="1"
                                       CornerRadius="12"
                                       Background="{DynamicResource ControlFillColorDefaultBrush}"
                                       BorderBrush="#FF9800"
                                       BorderThickness="2"
                                       Padding="25">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <!-- 回答标题 -->
                                    <Grid Grid.Row="0" Margin="0,0,0,20">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                                            <ui:SymbolIcon Symbol="Comment24"
                                                           FontSize="20"
                                                           Foreground="#FF9800"
                                                           Margin="0,0,10,0" />
                                            <ui:TextBlock Text="您的回答"
                                                          FontTypography="Subtitle"
                                                          FontSize="18"
                                                          FontWeight="SemiBold" />
                                        </StackPanel>

                                        <!-- 字数统计 -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,12,0,0"
                                                    HorizontalAlignment="Right">
                                            <ui:TextBlock Text="字数："
                                                          FontTypography="Caption"
                                                          FontSize="12"
                                                          Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                            <ui:TextBlock Text="{Binding AnswerWordCount}"
                                                          FontTypography="Caption"
                                                          Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                          Margin="4,0,0,0" />
                                        </StackPanel>
                                    </Grid>

                                    <!-- 回答内容 -->
                                    <ui:TextBox Grid.Row="1"
                                                Text="{Binding CurrentQuestionAnswer, UpdateSourceTrigger=PropertyChanged}"
                                                FontSize="14" TextWrapping="Wrap" AcceptsReturn="True"
                                                MinHeight="120" VerticalScrollBarVisibility="Auto"
                                                PlaceholderText="您的回答..." />
                                </Grid>
                            </ui:Border>
                        </Grid>
                    </Grid>

                    <!-- 右侧区域 -->
                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <!-- 摄像头预览 -->
                            <RowDefinition Height="Auto" />
                            <!-- 中间间距 -->
                            <RowDefinition Height="20" />
                            <!-- 语音识别 -->
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!-- 摄像头预览卡片 -->
                        <ui:Border Grid.Row="0"
                                   CornerRadius="12"
                                   Background="{DynamicResource ControlFillColorDefaultBrush}"
                                   BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                   BorderThickness="2"
                                   Padding="0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <!-- 摄像头标题栏 -->
                                <ui:Border Grid.Row="0" Height="50"
                                           CornerRadius="12,12,0,0"
                                           Background="#2196F3"
                                           Padding="20,0">
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <ui:SymbolIcon Symbol="Video24"
                                                       Filled="True"
                                                       FontSize="20"
                                                       Foreground="White"
                                                       Margin="0,0,10,0" />
                                        <ui:TextBlock Text="摄像头预览"
                                                      FontTypography="Subtitle"
                                                      FontSize="16"
                                                      FontWeight="SemiBold"
                                                      Foreground="White" />
                                    </StackPanel>
                                </ui:Border>

                                <!-- 视频预览区域 -->
                                <ui:Border Grid.Row="1" Margin="20,20,20,10"
                                           CornerRadius="8" Background="#0D1A2D"
                                           Height="200" MaxWidth="355"
                                           BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                           BorderThickness="1">
                                    <Grid>
                                        <!-- 摄像头视频显示 -->
                                        <ui:Border CornerRadius="6" Background="Transparent">
                                            <!-- 这里可以绑定实际的摄像头视频流 -->
                                            <Image Source="{Binding CameraPicture}"
                                                   Stretch="Uniform"
                                                   Height="200"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center" />
                                        </ui:Border>

                                        <!-- 无摄像头提示 -->
                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="40"
                                                    Visibility="{Binding IsCameraActive, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=True}">
                                            <ui:SymbolIcon Symbol="VideoOff24" FontSize="48" Margin="0,0,0,12" />
                                            <ui:TextBlock Text="摄像头未连接" FontSize="16" />
                                        </StackPanel>
                                    </Grid>
                                </ui:Border>

                                <!-- 面部分析信息 -->
                                <ui:Border Grid.Row="2" CornerRadius="8"
                                           Padding="12" Margin="20,0,20,20"
                                           VerticalAlignment="Bottom"
                                           HorizontalAlignment="Stretch">
                                    <StackPanel>
                                        <!-- 表情分析 -->
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <ui:TextBlock Text="表情：" FontTypography="Caption" Width="60" />
                                            <ui:TextBlock
                                                Text="{Binding FacialEmotion, Converter={StaticResource EnumDescriptionConverter}}"
                                                FontTypography="Caption" />
                                        </StackPanel>

                                        <!-- 头部姿态 -->
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <ui:TextBlock Text="头部姿态：" FontTypography="Caption" Width="60" />
                                            <ui:TextBlock
                                                Text="{Binding HeadPose, Converter={StaticResource EnumDescriptionConverter}}"
                                                FontTypography="Caption" />
                                        </StackPanel>

                                        <!-- 视线方向 -->
                                        <StackPanel Orientation="Horizontal">
                                            <ui:TextBlock Text="视线方向：" FontTypography="Caption" Width="60" />
                                            <ui:TextBlock
                                                Text="{Binding GazeDirection, Converter={StaticResource EnumDescriptionConverter}}"
                                                FontTypography="Caption" />
                                        </StackPanel>
                                    </StackPanel>
                                </ui:Border>
                            </Grid>
                        </ui:Border>

                        <!-- 语音识别卡片 -->
                        <ui:Border Grid.Row="2" CornerRadius="12"
                                   Background="{DynamicResource ControlFillColorDefaultBrush}"
                                   BorderBrush="#FF9800" BorderThickness="2" Padding="25"
                                   MaxHeight="1000">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <!-- 语音识别标题 -->
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                    <ui:SymbolIcon Symbol="Mic24"
                                                   FontSize="20"
                                                   Foreground="#FF9800"
                                                   Margin="0,0,10,0" />
                                    <ui:TextBlock Text="语音识别"
                                                  FontTypography="Subtitle"
                                                  FontSize="18"
                                                  FontWeight="SemiBold" />
                                </StackPanel>

                                <!-- 语音识别控制按钮 -->
                                <Grid Grid.Row="1" Margin="0,0,0,12">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="12" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="12" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="12" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <controls:TwoStateButton Grid.Row="0" Grid.Column="0"
                                                             Appearance="Primary" Padding="12,10"
                                                             IsChecked="{Binding IsSpeeching}"
                                                             EnableContent="开始识别"
                                                             EnableIcon="{ui:SymbolIcon Mic16}"
                                                             EnableCommand="{Binding StartSpeechRecognitionCommand}"
                                                             DisableContent="停止识别"
                                                             DisableIcon="{ui:SymbolIcon MicOff16}"
                                                             DisableCommand="{Binding StopSpeechRecognitionCommand}" />
                                    <ui:Button Grid.Row="0" Grid.Column="2"
                                               Content="填入"
                                               IsEnabled="{Binding IsSpeeching, Converter={StaticResource BoolInverseConverter}}"
                                               Padding="12,10" FontSize="14"
                                               Appearance="Success" Icon="{ui:SymbolIcon ArrowLeft24}"
                                               Command="{Binding AddSpeechAnswerCommand}" />
                                    <ui:Button Grid.Row="0" Grid.Column="4"
                                               Content="清空"
                                               Padding="12,10" FontSize="14"
                                               Appearance="Secondary" Icon="{ui:SymbolIcon Delete24}"
                                               Command="{Binding ClearSpeechRecognitionCommand}" />
                                    <ProgressBar Grid.Row="0" Grid.Column="6" VerticalAlignment="Center"
                                                 Height="16" Minimum="0" Maximum="1"
                                                 Value="{Binding MicrophoneVolume}" />
                                    <ui:TextBlock Grid.Column="0" Grid.ColumnSpan="7" Grid.Row="1" Margin="0,8,0,0"
                                                  Text="如果音量条有跳动但无识别内容，可检查设置内的日志信息。若无报错信息，则为星火AI服务异常。"
                                                  TextWrapping="Wrap" />
                                </Grid>

                                <!-- 识别结果显示 -->
                                <Grid Grid.Row="2">
                                    <ui:DynamicScrollViewer>
                                        <ui:TextBlock Text="{Binding SpeechRecognitionResult}"
                                                      FontTypography="Body"
                                                      FontSize="14" TextWrapping="Wrap"
                                                      MinHeight="60" Padding="12"
                                                      Background="{DynamicResource LayerOnAcrylicFillColorDefaultBrush}" />
                                    </ui:DynamicScrollViewer>
                                </Grid>

                                <!--<Grid Grid.Row="3" Margin="0,12,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    ~1~ 情绪标签 @1@
                                    <ui:TextBlock Grid.Column="0"
                                                  Text="情绪："
                                                  FontTypography="BodyStrong"
                                                  FontSize="14" />

                                    ~1~ 情绪值显示 @1@
                                    <ui:TextBlock Grid.Column="1"
                                                  Text="{Binding VoiceEmotion}"
                                                  FontTypography="Body"
                                                  FontSize="14" />
                                </Grid>-->
                            </Grid>
                        </ui:Border>
                    </Grid>
                </Grid>

                <!-- 底部按钮栏 -->
                <ui:Border Grid.Row="2"
                           CornerRadius="12,12,0,0"
                           Background="{DynamicResource ControlFillColorDefaultBrush}"
                           BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                           BorderThickness="1,1,1,0"
                           Padding="20,15">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- 返回首页按钮 -->
                        <ui:Button Grid.Column="0"
                                   Content="终止面试并返回前页"
                                   Padding="16,10"
                                   Appearance="Danger" Icon="{ui:SymbolIcon ArrowLeft24}"
                                   Command="{Binding StopAndBackCommand}"
                                   Margin="0,0,12,0"
                                   FontSize="14" />

                        <!-- 上一题按钮 -->
                        <ui:Button Grid.Column="2"
                                   Content="上一题" Icon="{ui:SymbolIcon ArrowLeft24}"
                                   Padding="16,10" Margin="0,0,12,0"
                                   Appearance="Secondary" FontSize="14" IsEnabled="{Binding HasGeneratedQuestion}"
                                   Command="{Binding PreviousQuestionCommand}" />

                        <!-- 下一页按钮 -->
                        <ui:Button Grid.Column="3"
                                   Content="下一页" Icon="{ui:SymbolIcon ArrowRight24}"
                                   Margin="0,0,12,0"
                                   Padding="16,10" FontSize="14"
                                   Appearance="Primary" IsEnabled="{Binding HasGeneratedQuestion}"
                                   Command="{Binding NextQuestionCommand}" />

                        <!-- 保存答案按钮 -->
                        <ui:Button Grid.Column="4"
                                   Content="保存答案"
                                   Padding="16,10"
                                   Appearance="Success" Icon="{ui:SymbolIcon Save24}"
                                   Command="{Binding SaveAnswerCommand}"
                                   FontSize="14" />
                    </Grid>
                </ui:Border>
            </Grid>
        </Grid>
    </Grid>
</Page>